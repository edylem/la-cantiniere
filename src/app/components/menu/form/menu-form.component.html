<p-dialog
  [(visible)]="visible"
  (onShow)="initEditedMenuGroup()"
  (visibleChange)="visibleChange.emit($event)"
  [modal]="true"
  [style]="{ width: '500px' }"
  [header]="'Modifier les idées de repas'"
  [dismissableMask]="true"
>
  @if (editedMenuGroup) {
  <div class="flex flex-column gap-3">
    <!-- Date -->
    <div>
      <label for="menuDate">Date de début</label>
      <p-datepicker
        id="menuDate"
        [(ngModel)]="editedMenuGroup.date"
        [showIcon]="true"
        dateFormat="dd/mm/yy"
        class="w-full"
      ></p-datepicker>
    </div>

    <!-- Liste des idées -->
    <div class="menus-section">
      <div class="menu-header">
        <label>Repas</label>
        <span class="personnes-label">Pers.</span>
        <span class="cooked-label">Cuisiné</span>
      </div>
      <div class="menu-items">
        @for (menu of editedMenuGroup.menus; track menu.num) {
        <div class="menu-row" [class.empty]="!menu.recipeId">
          <span class="menu-num">{{ menu.num }}.</span>
          <span class="menu-title flex-1">{{ getRecipeTitle(menu.recipeId) }}</span>
          <div class="personnes-field">
            <i class="pi pi-user"></i>
            <p-inputnumber
              [(ngModel)]="menu.personnes"
              [min]="1"
              [max]="20"
              [showButtons]="false"
              [inputStyle]="{ width: '2.5rem', textAlign: 'center' }"
            ></p-inputnumber>
          </div>
          @if (menu.recipeId) {
          <p-checkbox [(ngModel)]="menu.done" [binary]="true"></p-checkbox>
          <button
            pButton
            type="button"
            icon="pi pi-refresh"
            class="p-button-text p-button-sm"
            (click)="refreshRecipe(menu)"
            title="Changer l'idée de repas"
          ></button>
          <button
            pButton
            type="button"
            icon="pi pi-eye"
            class="p-button-text p-button-sm"
            (click)="viewRecipe(menu)"
            title="Voir la recette"
          ></button>
          <button
            pButton
            type="button"
            icon="pi pi-times"
            class="p-button-danger p-button-text p-button-sm"
            (click)="removeRecipe(menu)"
            title="Retirer l'idée"
          ></button>
          } @else {
          <button
            pButton
            type="button"
            icon="pi pi-refresh"
            class="p-button-text p-button-sm"
            (click)="refreshRecipe(menu)"
            title="Suggérer une recette"
          ></button>
          }
        </div>
        }
      </div>
    </div>

    <!-- Bouton Liste de courses -->
    <div class="mt-3">
      <button
        pButton
        type="button"
        label="Liste de courses"
        icon="pi pi-shopping-cart"
        class="p-button-outlined w-full"
        (click)="openShoppingList()"
      ></button>
    </div>

    <!-- Boutons -->
    <div class="flex gap-2 justify-content-end mt-3 pt-3 border-top-1 surface-border">
      <button pButton label="Annuler" class="p-button-text" (click)="onCancel()"></button>
      <button pButton label="Enregistrer" (click)="onSave()"></button>
    </div>
  </div>
  }
</p-dialog>

<p-confirmDialog></p-confirmDialog>

<!-- Dialog pour afficher la recette -->
<app-recipe-form
  [(visible)]="showRecipeDialog"
  [recipe]="selectedRecipe"
  [isReadOnly]="true"
></app-recipe-form>
<!-- Dialog Liste de courses -->
<app-shopping-list
  [(visible)]="showShoppingDialog"
  [menuGroup]="editedMenuGroup"
></app-shopping-list>
